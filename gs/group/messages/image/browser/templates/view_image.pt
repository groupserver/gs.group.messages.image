<html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  metal:use-macro="context/@@groupserver_site_home_layout/page">
  <head>
    <title metal:fill-slot="title">
      <tal:block replace="view/filename"/> by
      <tal:block replace="view/metadata/authorInfo/name"/>:
      <tal:block replace="view/metadata/topic/subject"/>:
      <tal:block replace="view/groupInfo/name"/>:
      <tal:block replace="view/siteInfo/name"/>
    </title>
    <tal:block metal:fill-slot="metadata">
      <link rel="prev" 
        tal:condition="view/metadata/prevURI"
        tal:attributes="href view/metadata/prevURI"/>
      <link rel="up"
        tal:attributes="href view/metadata/postURI" />
      <link rel="next"
        tal:condition="view/metadata/nextURI"
        tal:attributes="href view/metadata/nextURI"/>
      <link rel="bookmark" title="Group Homepage" href="#"
        tal:attributes="title view/groupInfo/name;
        href view/groupInfo/url" />
    </tal:block>
  </head>
  <body>
    <ul metal:fill-slot="breadcrumb" >
      <li><a tal:attributes="title string:${view/siteInfo/name} Homepage"
             href="/" title="Home">&#8962;</a></li>
      <li>
        <a tal:attributes="href view/groupInfo/relativeURL">
          <strong class="group" 
                  tal:content="view/groupInfo/name">This group</strong>
        </a>
      </li>
      <li><a class="topic" 
             tal:attributes="title view/metadata/topicShortName;
                             href string:/r/topic/${view/metadata/topic/last_post_id}"
             tal:content="structure view/metadata/topic/subject">Topic</a></li>
      <li><a class="post" 
             tal:attributes="title string:Post in ${view/metadata/topic/subject};
                             href view/metadata/postURI">Post</a></li>
      <li>Image</li>
    </ul>

    <div metal:fill-slot="body" class="gs-group-messages-image hmedia"
         tal:define="munge_date python:modules['Products.XWFCore.XWFUtils'].munge_date;">

      <ul id="gs-group-messages-image-navigation" class="inline-list navlinks">
        <li>
          <a tal:condition="view/metadata/prevURI" class="prev"
             tal:attributes="href view/metadata/prevURI;
                             title view/metadata/prevImage/file_name"
             href="#">Prev</a>
          <span tal:condition="not:view/metadata/prevURI" 
            class="prev">Prev</span>
        </li>
        <li>
          <a href="#" class="up"
            tal:attributes="href view/metadata/postURI">Post</a>
        </li>
        <li>
          <a tal:condition="view/metadata/nextURI" class="next"
             tal:attributes="href view/metadata/nextURI;
                             title view/metadata/nextImage/file_name"
             href="#">Next</a>
          <span tal:condition="not:view/metadata/nextURI" 
                class="next">Next</span>
        </li>
      </ul>

      <h1>Image <code tal:content="view/filename">filename</code></h1>
      
      <div id="scaled-image">
        <div class="metadata" tal:define="t view/metadata/mime;">
          <div tal:define="user view/metadata/authorInfo/user"
               tal:replace="structure provider:groupserver.UserImage">
            User image
          </div>
          <ul>
            <li id="from" class="contributor vcard">
              <a href="#" class="url"
                 tal:attributes="href view/metadata/authorInfo/url">
                <strong class="fn"
                        tal:content="view/metadata/authorInfo/name">Me!</strong></a>
            </li>
            <li id="date">
              <span class="minor">Posted at </span>
              <span class="date"
                    tal:content="python:munge_date(view.context, view.metadata.date)">A Date</span>
            </li>
            <li id="gs-group-messages-image-share">
              <a class="gs-content-js-share" href="#"
                 tal:attributes="public python:view.isPublic and 1 or 0;
                                 href string:${view/siteInfo/url}/r/img/${view/imageId};
                                 title view/filename;">Share</a>
            </li>
          </ul>
        </div><!--metadata-->
        <div class="enclosure"
             tal:define="s view/metadata/imageMetadata/file_size;
                         skb python:u'%1.2fKB' % (s/1024.0);
                         t string:Full sized image: ${view/fullImage/width} by ${view/fullImage/height} pixels (${skb})">
          <a href="#" title="Full sized image" 
             tal:attributes="href view/fullImageURI; title t">
            <img src="#" class="scaledImage photo"
                 tal:attributes="src view/scaledImageURI"/>
          </a>
          <p>
            <a href="#"
               tal:attributes="href view/fullImageURI"
               tal:content="t">Size</a>
          </p>
        </div>
      </div>
    </div>
    <tal:block metal:fill-slot="javascript">
      <script type="text/javascript"
              src="/++resource++sharebox-20121213.js">&#160;</script>
      <script type="text/javascript">
        jQuery.noConflict();
        jQuery(document).ready(function(){
          var public = true;
          jQuery('.gs-content-js-share').each(function () {
            shareWidget = GSShareBox(this, public);
            shareWidget.init();

            var p = {icons: {primary: 'ui-icon-carat-1-w'}, text: true}
            jQuery('.prev').button(p);
            jQuery('span.prev').button("disable");

            var up = {icons: { primary: "ui-icon-arrowthick-1-n" }, 
                      text: false,};
            jQuery('.up').button(up);

            var n = {icons: { secondary: "ui-icon-carat-1-e" }, text: true,}
            jQuery('.next').button(n);
            jQuery('span.next').button("disable");
          });
        });
      </script>
    </tal:block>
  </body>
</html>

